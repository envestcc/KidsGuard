<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KidsGuard â€” AI Child Safety Monitor</title>
  <link rel="stylesheet" href="/static/css/style.css" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ›¡ï¸</text></svg>">
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â• TOP NAV BAR â•â•â•â•â•â•â•â•â•â•â• -->
<nav class="topbar">
  <div class="topbar-left">
    <span class="logo">ğŸ›¡ï¸</span>
    <h1>KidsGuard</h1>
    <span class="badge badge-ai">AI-Powered</span>
  </div>
  <div class="topbar-right">
    <div class="connection-status" id="connectionStatus">
      <span class="status-dot offline"></span>
      <span>No Stream</span>
    </div>
    <button class="btn btn-sm btn-ghost" onclick="toggleTheme()" title="Toggle theme">ğŸŒ“</button>
  </div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â• MAIN LAYOUT â•â•â•â•â•â•â•â•â•â•â• -->
<main class="dashboard">

  <!-- â”€â”€â”€ LEFT: Stream Config â”€â”€â”€ -->
  <section class="panel panel-stream">
    <div class="panel-header">
      <h2>ğŸ“¹ Stream Source</h2>
    </div>
    <div class="panel-body">
      <div class="form-group">
        <label for="streamUrl">Live Stream URL</label>
        <div class="input-row">
          <input
            type="url"
            id="streamUrl"
            placeholder="https://www.youtube.com/watch?v=... or Twitch URL"
            value=""
          />
          <button class="btn btn-accent" onclick="validateStream()" id="btnValidate">
            Test
          </button>
        </div>
        <small class="hint">YouTube Live or Twitch stream with active LIVE badge</small>
      </div>

      <div id="streamStatus" class="stream-status hidden"></div>

      <!-- Stream Preview -->
      <div class="stream-preview" id="streamPreview">
        <div class="preview-placeholder">
          <span class="preview-icon">ğŸ“º</span>
          <p>Enter a stream URL and click <strong>Test</strong> to begin</p>
        </div>
      </div>

      <div class="form-group">
        <label for="cameraName">Camera / Location Name</label>
        <input type="text" id="cameraName" placeholder="e.g. Living Room, Nursery" value="Living Room" />
      </div>
    </div>
  </section>

  <!-- â”€â”€â”€ CENTER: Safety Checks â”€â”€â”€ -->
  <section class="panel panel-checks">
    <div class="panel-header">
      <h2>ğŸ” Safety Checks</h2>
      <span class="badge" id="checkCount">0 checks</span>
    </div>
    <div class="panel-body">
      <!-- Preset buttons -->
      <div class="preset-grid" id="presetGrid">
        <!-- Filled by JS -->
      </div>

      <!-- Custom condition -->
      <div class="form-group" style="margin-top: 1rem;">
        <label>Custom Safety Question</label>
        <div class="input-row">
          <input
            type="text"
            id="customCondition"
            placeholder="e.g. Is the child near the stove?"
          />
          <button class="btn btn-primary" onclick="runCustomCheck()">
            Ask AI
          </button>
        </div>
      </div>

      <!-- Latest result card -->
      <div id="latestResult" class="result-card hidden">
        <!-- Populated by JS -->
      </div>
    </div>
  </section>

  <!-- â”€â”€â”€ RIGHT: Monitoring & Digest â”€â”€â”€ -->
  <section class="panel panel-monitor">
    <div class="panel-header">
      <h2>ğŸ“¡ Live Monitor</h2>
    </div>
    <div class="panel-body">

      <!-- Webhook.site integration -->
      <div class="webhook-site-section">
        <div class="section-header">
          <h3>ğŸ”— Webhook Receiver</h3>
          <button class="btn btn-sm btn-accent" onclick="createWebhookSite()" id="btnCreateWebhook">
            Create Webhook URL
          </button>
        </div>
        <div id="webhookSiteInfo" class="webhook-site-info hidden">
          <div class="webhook-url-row">
            <span class="webhook-label">Webhook URL:</span>
            <code id="webhookSiteUrl" class="webhook-url"></code>
            <button class="btn btn-sm btn-ghost" onclick="copyWebhookUrl()" title="Copy">ğŸ“‹</button>
            <a id="webhookSiteViewLink" href="#" target="_blank" class="btn btn-sm btn-ghost" title="View on webhook.site">ğŸ”—</a>
          </div>
          <small class="hint">This public URL receives Trio webhook alerts â€” events are polled and displayed below</small>
        </div>
      </div>

      <!-- Monitor controls -->
      <div class="monitor-controls">
        <div class="form-group">
          <label>Monitoring Condition</label>
          <input
            type="text"
            id="monitorCondition"
            placeholder="e.g. Is the child in danger?"
            value="Is the child in any dangerous situation such as climbing, touching sharp objects, or near water?"
          />
        </div>
        <div class="btn-group">
          <button class="btn btn-success" onclick="startMonitor()" id="btnStartMonitor">
            â–¶ Start Monitoring
          </button>
          <button class="btn btn-danger" onclick="stopAllMonitors()" id="btnStopMonitor" disabled>
            â–  Stop All
          </button>
          <button class="btn btn-ghost" onclick="refreshJobs()">
            â†» Refresh
          </button>
        </div>
      </div>

      <!-- Active jobs -->
      <div class="jobs-section">
        <h3>Active Jobs</h3>
        <div id="jobsList" class="jobs-list">
          <p class="muted">No active jobs</p>
        </div>
      </div>

      <!-- Webhook Events Feed -->
      <div class="webhook-events-section">
        <div class="section-header">
          <h3>ğŸ“¨ Webhook Events <span class="badge" id="webhookEventCount">0</span></h3>
          <button class="btn btn-sm btn-ghost" onclick="pollWebhookSiteEvents()" title="Refresh events">â†»</button>
        </div>
        <div id="webhookEventsContainer" class="webhook-events-list">
          <p class="muted">Create a webhook URL and start monitoring to see events here</p>
        </div>
      </div>

      <!-- Digest -->
      <div class="digest-section">
        <div class="section-header">
          <h3>ğŸ“ Activity Digest</h3>
          <button class="btn btn-sm btn-accent" onclick="startDigest()">Generate Summary</button>
        </div>
        <div id="digestOutput" class="digest-output">
          <p class="muted">Click "Generate Summary" to get an AI narrative of the stream activity</p>
        </div>
      </div>
    </div>
  </section>

</main>

<!-- â•â•â•â•â•â•â•â•â•â•â• ALERT HISTORY PANEL â•â•â•â•â•â•â•â•â•â•â• -->
<section class="panel panel-history">
  <div class="panel-header">
    <h2>ğŸ“‹ Alert History</h2>
    <div class="history-controls">
      <select id="historyFilter" onchange="filterHistory()">
        <option value="">All Levels</option>
        <option value="high">ğŸ”´ High Danger</option>
        <option value="medium">ğŸŸ¡ Medium Warning</option>
        <option value="safe">ğŸŸ¢ Safe</option>
      </select>
      <button class="btn btn-sm btn-ghost" onclick="exportAlerts()">ğŸ“¥ Export</button>
      <button class="btn btn-sm btn-ghost" onclick="clearAlerts()">ğŸ—‘ï¸ Clear</button>
    </div>
  </div>
  <div class="panel-body">
    <div class="history-table-wrap">
      <table class="history-table" id="historyTable">
        <thead>
          <tr>
            <th>Time</th>
            <th>Level</th>
            <th>Condition</th>
            <th>Result</th>
            <th>Explanation</th>
            <th>Latency</th>
          </tr>
        </thead>
        <tbody id="historyBody">
          <tr><td colspan="6" class="muted">No checks yet. Run a safety check above.</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â• TOAST CONTAINER â•â•â•â•â•â•â•â•â•â•â• -->
<div id="toastContainer" class="toast-container"></div>

<script src="/static/js/app.js"></script>
</body>
</html>
